# Kubernetes概要
## 1. 冗長性とスケーラビリティのためのロードバランサー
* 冗長性  
    複数のサーバーのうち、何台かが故障しても残りのサーバーで処理できるようにする。

* スケーラビリティ  
    負荷が高くなったときは、サーバーの台数を増やすことで、より高負荷に耐えられるようにする。

こうした分散のためには、*ロードバランサー(Load Balancer：高負荷分散装置)*をサーバーの前に設置して、  
処理を振り分けるように構成する。

## 2. 全体を統括するオーケストレーションツール
    
    システム全体を統括管理するツールのこと。  
    管理者が指示を出すと、サーバーやコンテナ、ネットワークなどが構成されて、システム全体が自動構成される。

## 3. プログラムとデータの分離
コンテナの不具合や負荷対策のために増減した場合、そのコンテナ内のデータも失われてしまう。  
しかしバインドマウントやボリュームマウントでも解決できないケースもある。

* 別のサーバーにコンテナが移動する場合  
    サーバー自体にが不具合を起こした場合、別サーバーで動かすことになる(=コンテナの移動が必要)。  
    もしコンテナが利用しているデータがその障害の起きたサーバー内にある場合はデータが失われてしまう。

* サーバー間でデータを共有する場合  
    ユーザーは、ロードバランサーによってどのコンテナに接続されても、同じデータが見えていなくてはいけない。  
    例：ブログのようなコンテンツであるコンテナからデータをアップロードしたとき、  
        アップロード先が別のコンテナであった場合はそのコンテンツを見ることができない。
    
## 4. **コンテナのオーケストレーションツール「Kubernetes」(クバネティス：k8s)**
### 4-1. Kubernetesとは

コンテナ技術を中心に、それらをつなぐネットワークやストレージなど、複数台のサーバーにまたがってコンテナを動かすのに必要となるプラットフォームを提供する。  
Cloud Native Computing Foundationが管理しているプラグイン型ソフトウェアで、様々なツールと連携して動く。

### 4-2. Kubernetesの構成
複数台のサーバー群で構成されている。Kubernetesシステムを構成するサーバー群を「Kubernetesクラスター」という。  
* マスターノード  
    クラスター全体を統括管理するための「コントロールプレーン」と呼ばれるシステムをインストールしたサーバー。  
    管理者はこのマスターノードに指示を出す。5つのコンポーネントがあり、これらが連携してクラスターを統括管理する。

    * kube-apiserver  
        外部とやり取りするプロセス。
    * etcd  
        クラスター情報を全管理するDB
    * kube-controller-manager  
        一連のKubernetesオブジェクトを処理する「コントローラ」と呼ばれるコンポーネントを統括管理・実行する部分
    * kube-scheduler  
        Pod(コンテナが格納された最小実行単位)を、ワーカーノードへと割り当てる処理を行う。
    * cloud-controller-manager  
        Kubernetesを運用するクラウドサービス(AWS、Azure、GCPなど)と連携して、クラウドサービス上で  
        必要となるモノ(サービス)を作る仕組みのこと。  
        例えば、ネットワークやロードバランサー、ストレージとなるボリュームの構成などの処理がここで動く。

* ワーカノード  
    ネットワークやストレージなどを構成し、実際にコンテナを動かすサーバー群。  
    ワーカーノード内では、コンテナやネットワーク、ストレージを「Pod」と呼ばれる単位で管理する。  
    マスタノードからのみ制御され、管理者がワーカノードに対して、直接操作することはできない。
    
    * kube-let  
        マスターノード側のkube-schedullerと連携して、ワーカノード上にPodを配置し、実行する。  
        実行中のPodに異常がないかなどの状態を定期的に監視し、kube-schedullerへの通知も行う。  
    * kube-proxy  
        ネットワーク通信をルーティングする仕組み。

### 4-3. Kubernetesの運用はクラウドに任せる
Kubernetesはマスターノードとワーカーノードで構成される。多くの場合、冗長性や負荷分散を考慮してマスターノードやワーカノードは複数台で構成するため、  
複雑なシステムになり、安心・安全な管理が困難になる。  
そこでAWSやAzure、GCPなどで提供されているKubernetesのマネージドサービスを使う。

|       Cloud Service        |          Kubernetes Service's name           |   
|:---------------------------|:---------------------------------------------|
|AWS                         |Amazon EKS (Amazon Elastic Kubernetes Service)|
|Azure                       |AKS (Azure Kubernetes Service)                |
|GCP (Google Cloud Platform) |GKE (Google Kubernetes Engine)                |

Kubernetesのマネージドサービスを使えば、そのマネージドサービス上に、必要な数のワーカーノードを持ったKunernetesクラスターを構成できる。  
一般的な運用では、クラスター上のマスターノードに対して、kuberctlコマンドで指示を出すだけになる。  
Kubernetesは標準的なシステムで、いくつかの拡張機能の違いもあるが、どんなクラウドで運用されようと、kuberctlで操作する点は同じ。  

