# Linuxのインストールとパッケージ管理

***

## ハードディスクのレイアウト設計

### Linuxインストールに必要なパーティション
ハードディスクやSSDは**パーティション**に分割して利用できる。Linuxをインストールするには少なくとも2つのパーティションが必要。

* ルートファイルシステムに割当てるルートパーティション
* スワップ領域

>ただし実際にはさらにいくつかのパーティションに区切るのが一般的であり、理由は以下の通り。
* 柔軟なシステム管理を行うことができる
* ディスクに障害が発生したときの被害を抑えることができる
* 障害発生時にスムーズな復旧作業ができる

次に示すディレクトリ群は、独立したパーティションに割り当てるのが一般的。
* `/home`  
    一般ユーザがそれぞれ利用するファイルが格納される。多数のユーザが利用するシステムの場合は、とりわけ専用のパーティションに分割する必要がある。

* `/var`  
    各種ログファイルやメールスプールなど更新頻度の高いファイルが格納される。ログが大量に生成されログファイルが肥大化すると、  
    ファイルシステムの容量を超えてしまう恐れがある。

* `/usr`  
    プログラムやライブラリ、ドキュメントが格納される。後からプログラムを追加する等の事情がなければ、運用中に容量が増えることは基本的にない。  
    NFSを使ってコマンドやプログラムを共有する場合には、/usrを読み込み専用でマウントしておくことによりセキュリティを高められる。

* `/boot`  
    システムによっては、ディスクの先頭パーティションとして数100MB程度を/bootパーティションに割り当てたほうが良いときもある。  
    例：RAIDを使用する場合、内臓ハードディスク内に/bootパーティションが必要とされることもある。

* EFIファイルシステムパーティション(ESP)  
    UEFIを使ったシステムでは、FATファイルシステムでフォーマットされたEFIシステムパーティションが必要。  
    OSのブートローダやデバイスドライバなどが格納される。

* スワップ領域  
    仮想メモリ領域として利用される。スワップ領域のサイズ目安は、搭載されている物理メモリの1～2倍。

* / (ルート)  

### パーティションのレレイアウト設計
ディスクのパーティションレイアウトを設計する場合、以下に考慮する。
* システムの用途
* ディスクの容量
* バックアップの方法

1. 20GBのハードディスクと512MBのメモリを搭載している場合  
    * スワップ：512MB(物理メモリと同程度にする)
    * /(root)：19GB(残りがルートパーティションになる)

2. 200GBのディスクと1GBのメモリを搭載し、ユーザー100人が利用するFSを構築する場合(/home以下を共有する)
    * スワップ：1GB
    * /boot：100MB
    * /usr：10GB
    * /var：10GB
    * /：1GB
    * /home：約180MB

3. Webサーバを構築する場合(ディスク：100GB、メモリ：4GB、Webサーバ：Apache HTTP Server)
    * スワップ：4GB
    * /boot：100MB
    * /usr：10GB
    * /var：20GB
    * /var/log：50GB  
        Webサーバのログファイルが容量を必要とするため)
    * /：15GB

***

## ブートローダのインストール
ハードディスクなどのストレージからOSを読み込んで起動するプログラムを**ブートローダ**という。  
代表的なものにGRUBがある。

### GRUBのインストール
GRUBの特徴は以下
* 多数のファイルシステムを認識可能
* シェル機能を搭載し、コマンドによる高度な管理が可能

インストールするためのコマンドは以下  
`# grub-install /dev/sda`

### GRUB Legacyの設定
GRUB Legacyの設定ファイルは、`/boot/grub/menu.lst`。

|   Parameter   |           Description             |
|:-------------:|:----------------------------------|
|    timeout    |メニューを表示している時間(秒)|
|    default    |デフォルトで起動するエントリの番号|
|     title     |メニューに表示されるエントリ名|
|      root     |ルートデバイスの指定|
|    kernel     |起動するカーネルイメージファイルと起動オプションの指定|
|  makeactive   |ルートパーティションをアクティブ化|
|  hiddenmenu   |起動時に選択メニューを表示しない|