# STP (Spanning Tree Protocol)
    円環状(ループ状)に形成されたレイヤ2ネットワークにおいて、データトラフィックが永続的に流れ続ける事を防止するプロトコル。  
    信頼性の高いNW構築するためには、NW機器に障害が発生しても迂回路で通信できるように、複数のスイッチを使用したNW構成にするが、  
    そのような冗長化をした場合に*STPを有効にしなければ問題が発生*する。

## ブロードキャストストーム  
簡単に言うと、ネットワーク内にループ構造がある場合に起こりうる。
>3つのルータ間でARPリクエストに対するフラッディングを永遠に繰り返す、など

ループ状の構成にあるスイッチ全てのポートが転送できる状態であることから発生するこの現象によって、  
そのスイッチNWで使用可能な帯域幅を大きく消費し、この現象を処理する機器のCPU使用率が大幅に上昇して、通信不可となる。  

## BPDU (Bridge Protocol Data Unit)
STPでは、ループが発生しないようにSTA(スパニングツリーアルゴリズム)を使用し、自動的にあるポートをブロッキング状態にする。  
ブロッキングポートではフレームの送受信が行われなくなるので、ループを防ぐことができる。  
また、障害発生時には、自動的にそのポートがフォワーディング状態になり、通信ができるようになる。  

これらの制御はBPDUというフレームによって自動的に行われている。  
STPが有効なスイッチではBPDUを定期的にマルチキャストアドレスで送信する。

### BPDUのメッセージフォーマット
* ブリッジID  
    スイッチ自身のブリッジIDのこと。2byteのブリッジプライオリティと6byteのMACアドレスの8byteで構成。  
    スパニングツリーでは、ブリッジIDの情報によってスイッチを識別している。  
    ブリッジIDが最も小さい値のスイッチが***ルートブリッジ***と呼ばれ、ツリーの中心となる。

* パスコスト  
    ルートブリッジに至るまでの距離を示す情報。リンクの帯域幅kら自動計算される(管理者の手動設定も可能)  
    コスト値は低い値ほど優れているので、低いほどルートブリッジまでの距離が近いと判断される。