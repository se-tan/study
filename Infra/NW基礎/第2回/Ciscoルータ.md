# Ciscoルータ
|        Role        |                              Description                                 |
|:------------------:|:-------------------------------------------------------------------------|
|  スモールビジネス  |高度な機能とセキュリティがリーズナブルな価格で得られる                    |
|      ブランチ      |高度にセキュアな接続、機械学習、クラウドマネージド型セキュリティが得られる|
|WANアグリゲーション |サービスプロバイダやエンタープライズのNWエッジをデジタル時代にむけ変革    |
|       エッジ       |スケーラブルなNWエッジを実現するプログラマビリティで高密度に対応でき、耐障害性が向上|
|サービスプロバイダー|現在のニーズに答えながら将来の拡張ニーズにも対応でき、高いROIを確保する   |
|       産業用       |厳しく過酷な環境にもエンタープライズクラスの機能を提供する                |
|        仮想        |パブリック/プライベートクラウド等に対応したマルチテナントNWサービスを提供 |

## SOHOに最適なCisco ISRシリーズのルータ
Ciscoルータには、ルーティング処理を行う機能だけでなくセキュリティ機能、無線LAN機能、スイッチ機能など様々な機能を備えたものもあり、**Cisco ISR**として展開されている。  
SOHOのような小規模ネットワークには、このルータの導入が適しているといえる。  
この1台がFirewall機能、無線アクセスポイント、スイッチポートなどの役割を担ってくれるので、NW構成の簡略化と、機器導入コストの削減ができる。

## メモリの種類
### 1. ROM (Read Only Memory)
読み込み専用メモリ。3つのプログラムが格納されていて、消去はできない。

|  Program  |                                Description                                     |
|:---------:|:-------------------------------------------------------------------------------|
|    POST   |電源投入時に実行する自己診断プログラム。CPU, メモリ, I/Fのハードウェア試験を実施|
| BootStrap |コンフィグレーションレジスタ値の参照とCisco IOSの検索と読み込みを行う           |
|  ROMMON   |パスワード復旧やトラブルシューティングの際に使用するプログラム                  |

### 2. RAM (Random Access Memory)
読み書き可能なメモリ。このメモリにある情報はルータの電源OFF時に消去される。  
***runnning-config***(稼働中の設定情報)だけでなく、フラッシュメモリ内のIOSが展開する領域としても使用される。  
いわばルータの作業領域。動的な情報であるルーティングテーブルやARPテーブルもRAMに格納される。

### 3. NVRAM
読み書き可能なメモリ。不揮発性ランダムアクセスメモリである***NVRAM***はRAMとは異なり、  
電源OFF時もNVRAM内に格納された情報は保持される。  
***startup-config***(保存された設定情報)と***コンフィグレーションレジスタ***(ルータ起動方法を決定する値)がある。

### 4. フラッシュメモリ
読み書き可能なメモリ。IOSが格納されている。一般的にはIOSは圧縮されているので、RAMに解凍されて動作している。

## Ciscoルータへのアクセス方法
### 1. コンソール接続
最低限必要なものはPC、コンソールケーブル、Cisco機器本体。  
ルータ側のコンソールポートに接続するI/Fの形状は**RJ-45**となっていて、PC側に接続するI/FはDB-9となっている。  
USB to RS-232変換ケーブルを使用して、USBをPC側にしてCisco機器にコンソール接続する。

### 2. 電源ケーブルの接続
一般的には「AC100V/平行3ピン」のもの。アースがあるため通常の一般家庭用のコンセントでは接続不可。  
2ピンに変換するかOAタップを使用してコンセント接続する。

### 3. Tera Termを利用
Cisco機器の設定情報や各種ステータスを核にするためには、PCにターミナルエミュレータソフトウェアをインストールして使用する。  
1. Tera Termを使用するには、PCのデバイスマネージャでUSB Serial PortにCOMポートが何番が割り当てられたかを確認する。

2. シリアルポートに、デバイスマネージャで確認したCOMポート番号を選択する。

### 4. 起動順序
1. POSTの実行  
    POSTを実行してハードウェアの自己診断をする。

2. ブートストラップの実行  

3. コンフィグレーションレジスタの参照  
    ブートストラップによりコンフィグレーションレジスタ値が読み込まれて、起動モードが決定する。

4. Cisco IOSソフトウェアの検索  
    ブートストラップによりIOSが検索される。  
    NVRAMにあるstartup-configにboot systemコマンドで定義した内容に従い、読み込むIOSを決定する。

5. Cisco IOSソフトウェアのロード  
    boot systemコマンドで定義した内容に従い、IOSが読み込まれる。  
    コマンド定義がない場合は、フラッシュメモリ内にあるIOSが読み込まれてRAMにロードされる。

6. コンフィグレーションの検索  
    NVRAM内にstartup-configが存在するかどうかを検索する。

7. コンフィグレーションのロード  
    startup-configが存在する場合、それをRAM上にロードしてrunnning-configとして実行する。  
    存在しない場合は、セットアップモードとして起動する。

8. Cisco IOSソフトウェアの実行  
    running-configの内容に従って、IOSソフトウェアが実行される。

|フラッシュメモリ内のIOSで起動|   ROM内のmini IOSで起動   |  ROM内のROMMONで起動  |
|:---------------------------:|:-------------------------:|:---------------------:|
|            Router>          |        Router(boot)>      |       rommon 1 >      |

>知っておくべきコンフィグレーションレジスタの値
|Configration-Register|                 動作内容                    |
|:-------------------:|:-------------------------------------------:|
|        0x2100       |   ROMMONで起動させる  (基本的に使用しない)  |
|        0x2101       | mini IOSで起動させる  (基本的に使用しない)  |
|        0x2102       |       正常に起動させる/  (デフォルト値)     |
|        0x2142       |正常にIOSで起動させるがNVRAMを見させない(パスワードリカバリーで使用)|

### 5. 起動表示
初期状態時は、メッセージ出力をさせるコンフィグがすでに設定されているので、  
`erase startup-config`を入力し`reload`する。  
* セットアップモード  
    対話形式でのルータの基本設定を行うモードのこと  
    `Press RETURN to get started!`が表示されてEnterキーを押すとコンフィグ設定が行えるようになる。  
    >ただし一般的にセットアップモードで設定することはない。

* AutoSecure  
    IOS備わる機能で、この機能を使用することでCiscoルータのセキュリティ設定を自動的に実装、  
    または対話形式で実装することができる。自動的に実装する場合は、特権モードで  
    `auto secure no-interact`と入力すれば、シスコ推奨のセキュリティ設定が自動的にコンフィグされる。  
    これもNWエンジニアはまず使用しない。稼働中に絶対に入力してはいけないコマンド。

### 6. ホスト名の設定
デフォルトのホスト名は"Router"。  
このホスト名を変更することで、NW管理者がそのデバイスを管理しやすいようになる。  

### 7. インターフェースの有効化と無効化
CiscoルータはデフォルトでI/Fが無効化(shutdown)されている状態なので、使用するI/Fは有効化させる必要がある。  
有効化するためには、該当I/Fを指定したうえで`no shutdown`コマンドを入力する。  
無効化する場合は`shutdown`コマンドを入力する。`administratively down`と表示される。

### 8. インタフェースのIPアドレス設定
ルータの各I/FにはIPアドレスを設定する必要がある。  
I/Fコンフィグモードに移行してから`ip address [IPAddr] [SubnetMask]`を入力する。

### 9. インタフェースのdescription設定
インターフェースには説明文をつけることができる。`description [String]`

## Ciscoコマンド
### 1. show version
CiscoルータのIOSバージョン情報からFLASHメモリ/DRAMサイズ、ルータのアップタイムなどいろいろな情報を得ることができる。  

### 2. show runnning-config
現在稼働しているCiscoルータの設定内容を表示するコマンド。

### 3. show interfaces
CiscoルータのI/Fのステータスを確認できるだけでなくI/Fで送受信したパケットの統計情報や、  
5分間平均のスループット情報なども確認できる。(NE障害時の対応に役立つコマンド)  
`show interfaces [interfaces_name]`と入力するのが一般的。  
このコマンドの表示項目で重要なのは最初の1行目。
* `[interface_name] is up, line protocol is up`  
    カンマ左の文章は物理層が正常(キャリア検知ができている)  
    カンマ右の文章はデータリンク層が正常(キープアライブが成功している)  
    上記に項目だけを見たいなら`show ip interfaces brief`で確認できる。

## SSHの設定
Ciscoルータへtelnet接続したい場合、Ciscoルータ側の設定は、`line vtr`の部分にpasswordとloginコマンドを入力すればよいが、  
CiscoルータへSSH接続したい場合は、SSHサーバとして動作させるための設定が必要となる。
### 1. ユーザー認証の設定
SSHにおけるユーザ認証の方法には、パスワード認証と公開鍵認証の2種類(一般的にはパスワード認証)。

### 2. ドメイン名の設定
SSH暗号鍵生成のためにホスト名とドメイン名を指定する。

### 3. RSA暗号鍵の設定
SSHで使用するRSA暗号鍵を生成するために`crypto key generate rsa`コマンドを入力する。  
鍵長サイズの指定を求めてくるので、1024と指定するようにする。

### 4. SSHもバージョンの設定
`ip ssh version 2`と設定してSSH Version2を使用するようにする。

### 5. SSH接続を許可する設定
デフォルトでCiscoルータへのSSH接続は許可されている。  
→`All protocols are allowed on virtual terminal lines(vtys). Default is transport input all.`  
  
しかし例えば、Ciscoルータへの接続はSSHのみにしたい場合、line vtyの設定で  
`transport input ssh`と入力すれば実現可能  
  
*column CiscoルータからCiscoルータへSSH接続する場合*  
`ssh -l` [userName] [IPAddr] と入力する。