# Ethernet LAN
## 全二重通信 / 半二重通信
* 全二重通信 (full duplex)  
    データの送信と受信を双方から同時に行なえる通信方式。  
    CSMA/CDは無効化される(コリジョンが発生しないため)

* 半二重通信 (half duplex)  
    データの送信と受信を同時に行なえず、時間を区切って片方向からの送信しかできない通信方式。

> 全二重通信は、半二重通信の2倍の帯域幅を利用可能

## オートネゴシエーション機能
イーサネットLANでは機器同士で通信速度や通信モードを合わせていなければ、通信が不安定になる。  
オートネゴシエーション機能では、通信速度と通信モードを自動的に最適化する。  
機器間でFLPバーストという信号を交換することで、相手の通信速度と通信モードを検出し、優先順位に従って決定する。
>100BaseTXの全二重 > 100BaseTXの半二重 > 10BaseTの全二重 > 10BaseTの半二重

### オートネゴシエーション機能のトラブル
対向機器がオートネゴシエーション機能をサポートしていない場合や、無効にしている場合においては  
オートネゴシエーションが失敗し、通信モードの不一致が発生する。
> データトラフィックの送受信なら半二重通信でも「遅いな」程度だが、  
  ボイストラフィックの送受信の場合は、「音声品質がボロボロ」となるので、絶対に間違ってはいけない

## フロー制御
バッファメモリがあふれる前にフレームが送信されてくるのを防ぐもの。  

>スイッチでは、受信フレームを一度は共有のバッファメモリに格納し、MACアドレステーブルを使い  
宛先MACアドレスを見て必要な宛先に送信される。その後、そのフレームはメモリから消去される。  
複数のフレームが多数同時に送信されても、それらはすべてバッファメモリに蓄えられて、順次送信されるが、メモリ容量を超えるフレームはバッファされず破棄されてしまう。  
それによりTCP通信では再送処理によるタイムラグが発生してアプリの応答が悪化する。

### 半二重通信におけるフロー制御
**バックプレッシャ機能**を採用している。スイッチ上のメモリがあふれそうになると、スイッチは*ジャム信号*を送信する。  
これにより送信側はCSMA/CDに従い、ランダムな時間を待機してから再度フレームを送信するようになる。

### 全二重通信におけるフロー制御
**IEEE802.3xフロー制御**を採用している。*PAUSEフレーム*を送信すると、送信側は指定された時間だけ待機し、再度フレームを送信する。  
ただし、バッファに余裕ができた場合はスイッチからPAUSE解除フレームを送信するようになり、  
その場合はすぐに再度フレームを送信できるようになる。

* *columns 固定設定 vs Auto設定*  

    |        Type      |   Auto or 固定   |                      Reason                        |
    |:----------------:|:----------------:|:---------------------------------------------------|
    |NW機器⇔NW機器    |   Auto ⇔ Auto   |IEEE802.3uによる自動の最適化の結果を確認できるため  |
    |スイッチ⇔PC間    |   Auto ⇔ Auto   |クライアントPCのNICのデフォルト設定がAutoであるため |
    |スイッチ⇔サーバ間|サーバ側に合わせる|   ただし、どちらでもいい場合は、Auto設定を推奨     |
    |NW機器⇔ONU       |  ONU側に合わせる |既にキャリアで設定している状態に合わせざるを得ない為|

***

# ルータの動作の仕組み
通信相手のホストが異なるNWセグメントにいる場合、ルータやL3スイッチを経由して通信を行う必要がある。  
1つのセグメントでARPリクエストとARPリプライを行なってルータは送信元の情報を得て、  
宛先が同一セグメント内またはI/Fなのか等を認識し、別のセグメントでも同様の動作をする。

## ネットワークデバイスとOSI参照モデル
スイッチは第2層までみて、ルータは第3層までみで動作を行う。1階層だけ見て動作しているわけではない。