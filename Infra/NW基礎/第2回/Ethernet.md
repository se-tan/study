# Ethernet
コンピュータNWの規格の1つであり、最も使用されている***LANの規格***。 
OSI参照モデル上では物理層とデータリンク層の2階層に位置する。   
イーサネットが物理規格、TCP/IPが通信内容を取り決めている。

## 1. IEEE802.3の全体像
IEEEとは電気、電子分野における世界最大の学会。そしてIEEE802はLAN規格を定めている委員会。  
IEEE802.3はイーサネットLANに関する規格。

## 2. 帯域幅 (bandwidth)
* アナログ通信  
    使用する最低の周波数と最高の周波数の差のことを意味する。  
    Hz > KHz > MHz > GHz

* デジタル通信  
    最大転送速度のことを指す。      
    bps > Kbps > Mbps > Gbps

## 3. LANの規格
IEEEが定義するLAN規格では、データリンク層はLLC副層とMAC副層に分類される。
* MAC (Media Access Control)副層  
    媒体アクセス制御、MACアドレスのアドレッシング機構を提供する。  
    フレームの送受信方法、フレームの形式、誤り検出方法なども規定。物理層の上位。

* LLC (Logical Link Control)副層  
    論理リンク制御。イーサネットやトークンリングなどのNW媒体の種類の違いに関係なく、  
    ネットワーク層からネットワーク媒体を同じ手順で利用できるようにするもの。

## 4. イーサネットフレーム
イーサネットLANの通信を行う際に使用するデータフォーマットのこと。TCP/IPでいうパケットは、***フレーム***という。  
現在最も使用されているイーサネットフレームはDXI仕様。EthernetⅡを指す。

## 5. MACアドレスとは
イーサネットLAN通信において使用される物理アドレス。PCのNICやルータのLANポートなど各イーサネットカード(ポート)に固有のID番号。  
48ビットで構成されており、上位24ビットが***ベンダーコード***と呼ばれる。  
下位24ビットは各ベンダーが一意となるように割り当てる。(0017.9400.0001 または00.17.94.00.00.01と表記)  
PCのNICのMACアドレスはコマンドプロンプトで**ipconfig/all**で確認できる。  

ベンダーコードは初めの1byteのうち、先頭から7ビット目を**U/Lビット**、8ビット目をI/Gビットとして予約している。  
U/Lビットが「0」ならグローバルアドレスであり、「1」ならローカルアドレスを指す。

## 6. CSMA/CD (Carrier Sense Multiple Access with Collision Detection)
通信方式の1つで、初期イーサネットLANで使用されたアクセス制御方式。

### 6-1. CSMA/CDの動作
イーサネットフレームを転送したいPC端末はケーブルの通信状況(電気信号の状況)を確認し、  
フレームが伝送されていなければ自身のフレームを送信する。  
複数機器が同時に送信してデータが衝突した場合(コリジョン)、ある時間待って送信をやり直す。  

信号を感知(Carrier Sense)してフレーム伝送を行ない、フレーム衝突を検知(Collision Detection)すると  
ランダムな時間を待ち、送信を開始する。この方法で、1本のケーブル上を複数のノードがお互いにアクセス(Multiple Access)できるようになる。

***

# ネットワークデバイス
    Ethernet LANでは多くのNWデバイスが存在する。

## 1. リピータ(Layer1のデバイス)
物理層で動作し、ケーブルで流れる電気信号を増幅し波形を整えてもう一方のI/Fから電気信号を流す。  
ケーブル長が長いほど、電気信号が減衰し正しくデータを受信処理できないため使用されていた。

## 2. リピータハブ(Layer1)
リピータと同様だが、異なる点として、複数のポートを持っていること。

## 3. ブリッジ(Layer2)
データリンク層で動作し、リピータ同様の機能に加え、イーサネットフレームのヘッダを理解できる。  
イーサネットフレームヘッダの宛先MACアドレスを見て、適切なポートにフレームを転送できる。  

**フィルタリング**  
ブリッジはホストのMACアドレスを学習するとMACアドレステーブルに従いフレームを転送するため、  
無駄なトラフィックの発生を防いだり、コリジョンが起こりにくいので通信効率も上がる。
> コリジョンの発生範囲(***コリジョンドメイン***)を分割できるデバイス

## 4. スイッチ(Layer2)
スイッチングハブまたはL2スイッチと呼ばれる。たくさんのポートのあるブリッジ。  
ブリッジがフレームをソフトウェアにより処理するのに対し、  
スイッチは**ハードウェア(ASIC)により処理**するところが異なる。
> ***L3スイッチ***も存在し、各ポートがルーティングできる機能を持っている。  
ルータよりもパケット処理能力が高いため企業内のLANネットワークのコア機器として位置づけられる。  
ただし、ルータのようにWAN接続などの機能や暗号化処理など高度なソフトウェア処理はできない。

### 4-1. 機能
L2スイッチはデータリンク層でMACアドレスを見ながらフレームの宛先を判断して転送を行なう。  
スイッチを起動したあとは、MACアドレステーブルにはどのホストのMACアドレスも学習していない状態  

* フラッディング  
* フィルタリング  
* エージング

### 4-2. フレームの転送方式
1. ストアアンドフォワード  
    1つのフレーム全体を受信した後、メモリに蓄積(Store)してから、FCSによるエラーチェックを行い、  
    問題なければ転送(Forward)する。転送速度は遅く、高価な機器が必要だが、通信品質は高い。

2. カットスルー  
    フレームの先頭6byteだけ(宛先MACアドレスだけ)を読み込み、転送する。  
    転送速度は速いが、エラーチェックができないため通信品質は低い。

3. フラグメントフリー  
    フレームの先頭64byteだけを読み込み、フレームが正常か確認して、問題がある場合は破棄し、  
    正常なら転送する。上記2つの中間のような転送方式

### 4-3. 管理設定
IPアドレスやデフォルトゲートウェイを設定していなくても、スイッチに接続するホストやルータは問題なく通信できるが、  
スイッチのステータス確認や設定変更を行いたい場合にはIPアドレス等を設定する必要がある。

## 5. ルータ(Layer3)
物理層では電気信号の送受信を行い、データリンク層では、フレームヘッダのタイプを見ることで、  
上位層のプロトコルを識別する。  
IPパケットの場合は、NW層でパケットヘッダの「宛先アドレス」を見てルーティングテーブルに従ってパケットを転送するデバイス。
>イーサネットLANではデータは**フレーム**だが、TCP/IPでは**パケット**と呼んでいる

## 6. コリジョンドメインとブロードキャストドメイン
ブリッジやスイッチは、データリンクを分割するので、コリジョンドメインを分割できる機器だが、  
ルータも同様のことができる。しかしルータのI/Fは別々のNWセグメントを割り当てられることから、  
ブロードキャストも分割できる。  
→ルータはブロードキャストドメインを分割する機器でもある。

