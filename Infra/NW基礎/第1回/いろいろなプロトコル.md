# DHCP (Dynamic Host Configuration Protocol)
IPアドレスなどの情報を自動的に割り当てる**アプリケーション層プロトコル**  

## 1. 構成要素
|    Element     |      Role        |       Usage           |
|:--------------:|:----------------:|:---------------------:|
|   DHCPサーバ   |IPアドレスの設定情報などをDHCPクライアントに割り当てる|Windowsサーバ,Ciscoルータなど|
|DHCPクライアント|IPアドレスの設定情報などをDHCPサーバから割り当てられる|Windows OS等のPC, IP電話など|

## 2. DHCPのパケット
DHCPはUDP上で動作するプロトコル。  
DHCPサーバ宛のポート番号は「67」、DHCPクライアント宛のポート番号は「68」を使用。

## 3. 仕組み
1. 最初はDHCPクライアントは自身のIPアドレスを知らなければ、DHCPサーバのIPアドレスも知らない  
    ブロードキャストにDHCP Discoverメッセージを送信してNW全体に問い合わせる。

2. DHCPサーバはクライアントに割り当てるIPアドレス設定などをアドレスプールから選択して提案。  
    仕様によりDHCP Offerはブロードキャストで送信するので、その場合は宛先MACとIPはブロードキャストアドレスとなる。  

3. DHCPクライアントは提案されたIPを使用することを通知する。  
    DHCP Requestをブロードキャスト

4. DHCPサーバはDHCPクライアントが使用するIPアドレスの設定情報をDHCP Ackで送信する。

## 4. DHCPリレーエージェント
    DHCPサーバとDHCPクライアントとの通信ではブロードキャストアドレスが使用されるので、  
    DHCPサーバとDHCPクライアントは同じNW(サブネット)にいる必要がある。  
    しかし現在のLAN-NWは多くのサブネットが存在し、そのサブネットをルータやL3スイッチで分離している。  
    ルータやL3スイッチはブロードキャストを通過させないのでDHCP環境を構築したい場合に、  
    DHCPリレーエージェント機能が役に立つ。  
DHCPサーバとDHCPクライアントが異なるサブネットに存在しても、  
DHCPクライアントから受信した***ブロードキャストをユニキャストに変換***して、DHCPサーバに転送する。

***

# DNS (Domain Name System)
ドメイン名をIPアドレスに自動的に変換する**アプリケーション層プロトコル**。  
覚えにくいIPアドレスではなく文字列でURLを入力したり、メールアドレスを入力できるようにする。

## 1. ドメイン名の構造
|     Domain Lv.     |            Description           |       Example             |
|:------------------:|:--------------------------------:|:-------------------------:|
|トップレベルドメイン|TLDでは国別、地域、商用などを表す |jp(日本), com(商用)        |
|  第2レベルドメイン |組織の種類を表す                  |co(一般企業), ac(教育機関) |
|  第3レベルドメイン |具体的な企業名や組織などを表す    |yahoo, ntt, keio           |
|  第4レベルドメイン |「ホスト名」に位置付けされる      |www(Webサーバ), ftp        |

## 2. DNSの構成
|   Compose    |                Role              |       Example             |
|:------------:|:--------------------------------:|:-------------------------:|
|   DNSサーバ  |ドメイン名-IPアドレスの対応表を保持するホストまたはソフトウェア|Windowsサーバ, Linuxサーバなど|
|リゾルバ|DNSサーバに問い合わせを行うホストまたはソフトウェア|Windows OSなどのPC等|

各階層のDNSサーバは耐障害性を考慮して、複数のDNSサーバにより構成されている。  
DNSサーバはゾーン情報のマスターデータを管理する**プライマリDNSサーバ**と、  
バックアップとなる1台以上の**セカンダリDNSサーバ**によって構成される。  
> **ゾーン転送**  
    同じ情報を共有するため、定期的にセカンダリDNSサーバにゾーン情報を転送している。

## 3. DNSのパケット
リゾルバがDNSサーバに行なうドメイン名からのIPアドレスの名前解決にはUDP(ポート番号53)を使用する。  
一方、ゾーン転送を行う場合はTCP(ポート番号53)を使用する。

## 4. DNSによる名前解決の仕組み
1. WebブラウザでURLを入力すると、そのPCで指定したDNSサーバに問い合わせをする。

2. 対応表がDNSサーバのゾーン情報になくキャッシュにもない場合、ルートDNSサーバへ問い合わせる。  
    www.cisco.comのDNS → comのDNS → cisco.comのDNS

***

# HTTP (HyperText Transfer Protocol)
    WebサーバとクライアントのWebブラウザがデータを送受信するために使用されるアプリケーション層プロトコル。  
    HTML言語による文書、画像、音声、動画等のファイルを表現形式を含めてやり取りできる。

## 1. HTTPのパケット
TCPプロトコル上で動作しており、Webサーバにアクセスするために使用しているのはポート番号**80**

## 2. Webアクセスの仕組み
1. 利用者がWebブラウザにURLを入力してEnterキーを押す。
2. Webブラウザは指定したWebサーバに**HTTPリクエスト**を送信し、Webページのデータを要求する。
3. Webサーバは、Webブラウザから受信したHTTPリクエストを解析。
4. Webサーバが、Webブラウザに要求されたデータを**HTTPレスポンス**として返信。
5. Webブラウザは、受信したデータを解析してWebページとして表示。

## 3. HTTPリクエストメッセージ
HTTPリクエストのメッセージはリクエスト行、メッセージヘッダ、空白行、メッセージボディで構成  
特にリクエスト行にあるメソッド部分は重要。

|   Type of method   |            Description               |
|:------------------:|:------------------------------------:|
|         GET        |データを取得することをWebサーバに要求 |
|         HEAD       |メッセージヘッダだけをWebサーバに要求 |
|         POST       |Webサーバにデータを送信する           |
|         PUT        |Webサーバに、ファイルをアップロード   |
|        DELETE      |Webサーバ上にあるデータ削除を要求     |
|       CONNECT      |プロキシサーバなどにトンネル確立を要求|

## 4. HTTPレスポンスメッセージ
ステータス行、メッセージヘッダ、空白行、メッセージボディで構成される。  
ステータス行は重要。

| Status Code |            Description                    |        Example         |
|:-----------:|:-----------------------------------------:|:----------------------:|
|   100番台   |情報：続きの情報があることを伝える         |  100(Continue)         |
|   200番台   |成功：リクエストに処理できたことを伝える   |  200(OK)               | 
|   300番台   |リダイレクト：別URLへリクエストするよう要求|  301(Moved Permanently)|
|   400番台   |クライアントエラー：リクエストに問題がある |  404(Not Found)        |
|   500番台   |サーバエラー：サーバ側に問題がある         |  503(Service Unavable) |

***

# SMTP (Simple Mail Transfer Protocol)/ POP (Post Office Protocol)
* SMTP  
    電子メールを送信するために使用するアプリケーション層プロトコル。ポート番号は25

* POP  
    電子メールを受信するために使用するアプリケーション層プロトコル。ポート番号は110

***

# Telnet
NWに接続された機器を遠隔操作するために使用するアプリケーション層プロトコル。

## 1. Telnetのパケット
宛先ポート番号は23を使用。

## 2. 仕組み
1. コネクションの確立
    PCからのtelnetはコマンドプロンプトから「telnet IPアドレス」と入力するか、  
    Tera Term等でIPアドレスを入力してtelnetを行う。

2. TCPによるコネクション確立後
    PCのコマンドプロンプトでtelnetサーバからの応答画面が表示される。  
    telnetで遠隔操作を行うためには、対象機器にログインする必要があるため、  
    最初の応答画面ではパスワードが要求される。

## 3. SSH (Secure SHell)
    NWに接続された機器を遠隔操作するために使用するアプリケーション層プロトコル。ポート番号は22  
    telnetではパスワード情報を含む全てのデータが暗号化されずに送信されるが、  
    SSHではパスワード情報を含む全てのデータが暗号化されて送信される。

## 4. SSHのバージョン]
* SSH1 (Version 1)  
    **RSA**公開鍵暗号

* SSH2 (Version 2)  
    **DSA**公開鍵暗号

***

# FTP (File Transfer Protocol) 
    特定のコンピュータ間でファイル転送するときに使用するアプリケーション層プロトコル。  
    相手先コンピュータにログインしたうえでファイル転送を行う。  
    FTPを利用すればファイルをFTPサーバにアップロードしたり、FTPサーバからダウンロードしたりできる。

## 1. FTPの2つのTCPコネクション
1. 制御用  コントロールコネクション(ポート番号21)
    ログインするためのユーザー名やパスワード情報やファイル転送方法などの命令と応答などに使用。  

2. データの転送用   データコネクション(ポート番号20)
    転送されるデータの送受信のために使用される。