# TCPとUDP
IPの上位プロトコルでトランスポート層で動作する。  
ネットワーク層のIPとセッション層以上のプロトコル(HTTP, FTP, Telnet)の橋渡しをする。

* TCP  
コネクション型通信で信頼性が高い。

* UDP (User Datagram Protocol)  
コネクションレス型通信で、信頼性が高くないが、速さやリアルタイム性を求める通信に使用

***

# TCP

## 1. ポート番号
コンピュータが通信を行うために通信先の*アプリケーションを特定するための番号*。  
|   Type    |   Range   |                 Description                   |
|:---------:|:---------:|:----------------------------------------------|
|well-known |  0~1023   |IANAで管理。サーバのアプリケーション用         |
|   登録済  |1024~49151 |IANAで管理。独自に作成したアプリケーション用   |
|  Dynamic  |49152~65535|クライアント側のアプリケーションに自動で割り当てる   |

## 2. コネクションの確立と切断
コネクション型プロトコルのため、データ転送前にコネクションを確立する。  
***3ウェイハンドシェイク***  
1. 送信元(A)から送信先(B)にコネクションの確立をする。  
    TCPヘッダのSYNビットは「1」であり、ACKビットが「0」である。
2. BはAのコネクション要求に応える。さらにBからもコネクション確立を要求する。  
    SYNとACKは「1」
3. AもBからのコネクション要求に応える。   
    SYN「0」でACK「1」
※SYN=質問の目印(送っていい?的な)、ACK=返事の目印(いいよ!的な)

## 3. 信頼性の確保
### 3-1. 順序制御
TCPではすべてのTCPパケットに***シーケンス番号***を付与する。  
データを分割送信しても、シーケンス番号の値があるため、受信側は正しく組み立てられる。

### 3-2. 再送制御
データ送信の度にデータが正しく到達できたことを知らせるために***確認応答(ACK)***を行う。  
ホストAからホストBへデータを送信できれば、ホストBはホストAに確認応答としてACKビットを立てて返信する。  
この確認応答がない場合はNW伝送経路の途中でパケットが破棄された可能性がある。  
TCPでは一定時間内にACKが返ってこない場合は、データを再送する。

### 3-3. 通信効率の向上 (ウィンドウ制御)
TCPでは、ACKの確認応答により信頼確保はできているが、通信速度が遅くなりやすい。  
そこでTCPヘッダにある***ウィンドウサイズ***を利用することでこの問題を解決している。  
> ウィンドウサイズ：ACKを待たずに一度に送信できるデータ量  

例：  
ウィンドウサイズが3900バイトであると送信側のホストに伝えた場合、送信側は3900バイト分まではACKを待たずに送信する。

* *column スライディングウィンドウ*  
    ACKを受信したら、その分のウィンドウをスライドさせながらデータを送信する方法。

### 3-4. 通信効率の向上 (フロー制御)
ウィンドウサイズの値は、3ウェイハンドシェイクの際にお互いに伝えられる。  
お互いのウィンドウサイズがわかるので、スライディングウィンドウにより実際には連続的にデータをやり取りしている。  
しかし、多数の送信側ホストが同時にデータ送信して負荷が高まると、受信側はデータを処理しきれなくなる。  
この場合、受信側はウィンドウサイズを小さくしてその値を送りなおす。  
受信可能な状態になれば、ウィンドウサイズを大きくして通知する。この処理をフロー制御という。

***

# UDP
## 1. UDPの特徴
TCPに比べると信頼性がないものの拘束に転送を行うことができる。  
UDPヘッダサイズが8byte少ないことから、その分アプリケーションのデータを多く送受信することができる。  
ただし、パケットロスなどの場合はアプリケーション側で再送処理をして通信を成立させるか、パケットロスを容認できるアプリの必要がある。

## 2. UDPの用途
1. 音声や映像などのリアルタイム性のあるデータを転送する場合  
    TCPのように確認応答をしていると、音声通話が途切れたり、聞き取れなかったりする。  
    この場合ではUDPのほうがデータ転送は高品質となる。

2. 複数の相手に同じデータを同時転送する場合  
    TCP通信では、1対1でコネクションを確立する必要があるので、ユニキャスト通信のみ。  
    マルチキャスト通信やブロードキャスト通信では、UDPが適している。

3. 信頼性が必要なく、少量のデータ転送をしたい場合  
    DNSサーバとクライアントPCでのデータ通信は、クライアントからの1回の問い合わせと  
    DNSサーバからの応答1回のデータ転送で完了する。この場合もUDPのほうが適している。