
## PPPoE (PPP over Ethernet)
PPPの機能をEthernet上で利用するためのプロトコル。  
シリアルのWAN回線やISDN接続の際によく使用されるプロトコルだが、LANにおいても利用可能にしたもの。  
LAN上でもユーザ認証が可能であり、IPアドレスの割当も可能なので、  
常時接続のADSLサービスやFTTHサービスで広く使用されているプロトコル。

### IP通信確立方法
PPPoE接続でIP通信ができるようになるには、DiscoveryステージとPPPセッションステージの2ステップ必要。

1. Discoveryステージ  
    PPPoEセッションを確立するPPPoEクライアントとPPPoEサーバのMACアドレスを特定し、PPPoEセッションIDの割当を行う。  

2. PPPセッションステージ  
    PPPoEサーバがPPPoEクライアントにセッションIDを通知すると、このステージに移行する。  
    PPPセッションステージにより認証が成功して、  
    PPPoEサーバから適切なIPアドレスが割り当てられるとPPPoE接続は終了する。

### ISPの認証サーバへの振り分け
Bフレッツを契約すると、NTTからレンタルでONU(回線終端装置)が設置されることになる。  
契約者がONUを変更することなくISPを乗り換えられるのは、振り分けが実装されているため。  

1. PPPの認証の際にサーバへユーザIDを送信
2. ユーザIDの情報に基づいてISPのサーバへ送信  
    この際にRadius(認証)サーバにユーザIDとパスワードを送信して認証
3. 認証成功後のパケットは自動的にISPサーバに送信される

### PPPoE方式
1. **端末型払い出し**  
    1つのPPPoEセッションに1つのグローバル***IPアドレス***を動的に払い出す方式。
    
2. **LAN型払い出し**  
    1つのPPPoEセッションに1つのグローバル***IPセグメント***を払い出す方式。  
    IPセグメントは例えば/28と付与される。その場合グローバルIPが16個付与されることになる。

