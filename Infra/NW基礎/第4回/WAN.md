# WAN (Wide Area Network)
NTTなどの電気通信事業者が提供するWANサービスを利用して、地理的に離れた拠点のLANを相互に接続するNW。

## SLA (Service Level Agreement)
サービス品質の、キャリアと利用者との間の合意のこと。  
WANでのIPパケットの往復転送時間が月間平均10msを超えた場合や、  
障害発生の故障回復までの遅延が1時間以上発生した場合に、企業に利用料金の一部を返還する合意のこと。

## 基本構成とデバイス
* DTE (Data Terminal Equipment)  
    データを送受信するユーザ側の機器。
* DCE (Data Circuit-Traminating Equipment)  
    DTEから送られてくる信号をDCEが接続している網に適した信号に変換して送信する。  
    WANがシリアル回線の場合、DCEはクロック信号を送信する。DCEはモデム、ONU、DSUが該当する。
* CPE (Customer Premises Equipment)  
    契約した加入者宅に設置される通信機器の名称。DCEだけでなくDTEなども含まれる。
* 分解点  
    キャリアと加入者の責任分解点を示す。DCE以降はキャリア、DCEまでの配線部分までが加入者の責任。
* ローカルループ  
    加入者の敷地にある責任分解点からキャリア網のWAN機器までの回線のこと。  
    PSTNやISDNの場合はローカルループ、それ以外ならアクセス回線という。

|  DCE  |                                       Description                                 |
|:-----:|:---------------------------------------------------------------------------------:|
|モデム |          PSTNとの接続に使用されるDCE。アナログのローカルループを終端する          |
|  DSU  |ISDNか、デジタル専用線との接続時に使用されるDCE。デジタルのローカルループを終端する|
|  ONU  |     IP-PVPNや広域イーサネットor高速なデジタル専用線との接続時に使用されるDCE      |

## 回線の種類
WANサービスは***専用型***と***交換型***の大きく2つに分類され、  
交換型は**回線交換**と**パケット交換**の2つにさらに分類される。  
1. 専用型  
    利用者が回線を独占して使用する方式  
    1-1. 専用線  
        自社専用として回線を借りて1対1で拠点間接続できる。  
        セキュリティが保証され信頼性が高いが、コストも高い。

2. 交換型  
    複数の利用者が回線を共有する方式  
    1-1. 回線交換  
        通信時だけ接続を確立して、通信が終了したら切断する。  
        コストは従量課金制となる。信頼性がなく通信速度も遅い。  
        例：PSTN、ISDN
    
    1-2. パケット交換  
        1本の物理回線上で複数の仮想回線で拠点間接続できる。  
        データは仮想回線を識別する制御情報が付加されて伝送される。  
        専用線より安価で、回線交換より信頼性が高く、通信速度も速い。  
        例：フレームリレー、ATM、IP-VPN、広域イーサネット

### 専用線
契約したユーザが回線を占有して使用できる回線サービス。1対1のポイントツーポイントで接続される。  
定額制だが、拠点間の距離、通信速度、接続する拠点数等に比例して高くなる。

### PSTN (Public Switched Telephone Network)
公衆電話網であり主に音声通信用の回線サービス。通信中のみ回線を占有して、終了すれば解放する。  
利用料金は、接続先への距離と通信時間によって課金される従量課金制。  
通信速度は56Kbpsであり、コールセットアップに時間がかかる。

### ISDN (Integrated Service Digital Network)
音声通信とデータ通信を統合した回線サービス。通信開始時に通信を確立させて通信が終了したら切断する。  
1つの物理回線に対して複数の論理チャネルがある。

|論理チャネル|                            Description                                 |
|:----------:|:----------------------------------------------------------------------:|
|  Bチャネル |                   データの伝送に使用される通信チャネル                 |
|  Dチャネル |コールセットアップ(シグナリング)の制御情報の伝送に使用される制御チャネル|

ISDNには、BRI(Basic Rate Interface)、PRI(Primary Rate Interface)の2つのI/F規格がある。  

* BRI (基本インターフェース)  
    64kbpsの2本のBチャネルと16kbpsのDチャネルで構成される。  
    2つのBチャネルがあるので、同時に2回線を使用できる。また、2つのチャネルを束ねて128kbpsとして  
    データ通信をすることもできる。

* PRI (一次群速度インターフェース)  
    64kbpsの23本のBチャネルと64kbpsの1本のDチャネルで構成。  
    23の論理チャネルによ23拠点同時接続ができる。

### パケット交換
パケット回線の回線タイプでは、データを細かい単位(パケット)に分割してキャリア網のネットワークへデータを伝送する方式です。  
各パケットには宛先となる識別情報を付加することで、相手先(通信先)を特定して拠点間で通信が可能になる。  
通信中に回線を占有しないことから、理論上キャリア網内での**輻輳**が発生する可能性がある。

1. フレームリレー  
    前身のX.25というWANサービスからエラー訂正機能を除去したWANサービス。  
    エラー訂正、確認応答、再送制御等を行わないため高速データ伝送を実現している。  
    1つの物理回線上で複数の仮想回線を用意して複数の拠点間通信を可能にしている。

|      FR       |                            Description                                 |
|:-------------:|:----------------------------------------------------------------------:|
|     PVC       |Permanent Virtual Circuit。契約時に定義した通信相手と固定接続する仮想回線|
|     SVC       |Switched Virtual Circuit。接続を動的に確立して通信終了時に切断する一時的な仮想回線|
|     DLCI      |VCを識別するもので、FRヘッダ内にある情報|
|  Inverse ARP  |ローカルのDLCI番号と宛先ルータのIPアドレスのFRマップを動的に生成するプロトコル|
|     LMI       |Local Management Interface。ルータとFRスイッチ間のステータスを保持する|
|ローカルアクセスレート|ルータとFRスイッチ間のアクセス回線の速度|
|     CIR       |Commited information Rate。契約時に定義するFR網内におけるPVCごとの保証速度|
|FECN|Forward Explicit Congestion Nortification。FR網内の輻輳状態を宛先に知らせる為のFRヘッダフィールド|
|BECN|Backward Explicit Congestion Nortification。FR網内の輻輳状態を送信元に知らせる為のFRヘッダフィールド|

2. ATM (Asynchronous Transfer Mode)  
    セルリレーのWANサービスは、FR同様に1つの物理回線を共有して複数のVCを生成することができます。  
    53byteの固定長のデータであるセルを基本的な通信単位としている。  
    セルは5byteのヘッダと48byteのデータ(ペイロード)で構成される。

3. IP-VPN  
    キャリア網のIPネットワークを利用者で共有して、MPLS(Multi-Protocol Label Switching)により、  
    企業ごとのNWを仮想的に分離している。

    * MPLS (Multi-Protocol Label Switching)  
        L2ヘッダとIPヘッダの間にラベルと呼ばれるヘッダをつけてラベル情報に基づきIPパケットを転送する(ラベルスイッチング)。  
        IPヘッダは20byteでありこの情報でIPルーティングしてパケット転送するよりも、  
        MPLSラベルの4byte程の情報でラベルスイッチングするほうが高速に転送できる。  
        LERと呼ばれるPEで企業からのパケットを受信するとラベルを付与し、  
        キャリアのMPLS網内にパケットを転送する。  
        次にLSRがラベルテーブルに従ってラベル情報を付け替えて転送する。

        1. LER (Label Edge Router)  
            MPLS網のエッジに配置される企業NWのルータと接続するPE。パケットのラベルの着脱を行う
        2. LSR (Label Switching Router)  
            ラベル付けされたパケットを受信し、ラベルテーブルに従ってラベルの付け替えを行い転送する  
            Pルータともいう
        3. ラベル配布プロトコル  
            ラベルの情報に関して広報するためのプロトコル。LDP,TDP,RSVP,BGPなどが該当する
        4. FEC (Forwarding Equivalence Class)  
            MPLS網で同じ宛先のパケットや同じ扱いをさせるパケットの集まり。
        5. LSP (Label Switching Path)  
            ラベル付けされたパケットがラベルスイッチングされていく片方向のパス

4. 広域イーサネット  
    キャリア網で用意されたイーサネット網に、企業NWのイーサネットLANを直接接続して、広域なLAN間接続を実現できる(つまりキャリア網でもイーサネットスイッチでWANが構築されている)。  
    Layer2はEthernet LANである必要があるが、Layer3で使用するプロトコルに制限はない。  

    L2/L3スイッチをONUに直接接続することで、地理的に離れた拠点間を同じIPのNWセグメントにできる。

### WANカプセル化プロトコル
1. HDLC (High-level Data Link Control)  
    シリアルI/Fで専用線などのポイントツーポイント接続で使用するデータリンク層プロトコル。  

2. PPP (Point-to-Point Protocol)  
    専用線、PSTN、ISDNなどのポイントツーポイント接続で最も使用されるデータリンク層のプロトコル。  
    認証、圧縮、マルチリンク、エラー制御をオプションとしてサポートしている。

    2-1. LCP (Link Control Protocol)  
        リンク確立、維持、切断処理  
    
    * 認証 (PAP, CHAP)  
        PPPで接続要求を行なってきたデバイスのユーザ名とパスワードを確認して  
        事前に登録した正しい情報であれば認証を成功しPPPリンクを確立させる。  

    * 圧縮 (Predictor, Stac, MPPC)  
        データ圧縮でデータ量を少なくできるので低速なWANリンクでも効率的に通信することができるが、  
        圧縮による問題点もある。一般的には使用しない。
    
    * マルチリンク (MLP)  
        デバイス間での複数の平行するPPPリンクを1つの論理的なリンクとして使用できる。
    
    * エラー検出 (Quality, MagicNumber)  
        QualityとMagicNumberで、PPPリンクのエラーを検出しデータリンク品質を高める。

    
    2-2. NCP (Network Control Protocol)  
        ネットワーク層プロトコルを惜別するためのタイプフィールドを持っており、  
        NW層がIPならIPCP、IPXならIPXCPをNCPとして使用し通信の開始、終了をする。