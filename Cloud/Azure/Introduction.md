# Azure概要

## ■ 展開モデルの選択

- Azure (public cloud)
- System Center (private cloud)
- Azure Stack (hybrid cloud)

***

## ■ サブスクリプション

### - **テナントとサブスクリプション**

- サブスクリプション：契約を行う基本単位。
- テナント：会社などの組織単位のこと。**Azure AD**で管理される。
- クォータ

- 課金境界  
  サブスクリプション単位で課金

- アクセス制御境界  
  サブスクリプションレベルでアクセス許可を設定できる

### - **サブスクリプションの種類**

- 従量課金(Webダイレクト)  
  MicrosoftのWebサイトから直接申し込む。完全従量課金契約の為、PAYGともいう。

- エンタープライズアグリメント(EA)  
  Microsoftと直接契約し、1年単位の利用料をコミットする。

- 無料試用版  
  30日間で200ドル分のサービスを利用できる、または一部サービスを12か月間無料利用できる。

- メンバープラン  

***

## ■ サブスクリプションとリソースの管理

### - **Azure Resource Manager**

Azureのリソースの作成、構成、管理、削除を行なうための管理サービス。  
Azureポータル、Azure PowerShell、Azure CLIなど。

ARMはJSON形式で情報を記述してデプロイを行う。JSONファイルのことをARMテンプレートと呼ぶ。

### - **リソースグループ**

Azureが作成するインスタンスをリソースという。リソースグループは、協調して動作する複数リソースを扱うためにある。

- アクセス制御  
  リソースグループに設定したアクセス許可は、そのリソースグループに所属するリソースに継承されるため、所属するリソースの利用権を設定する。

- ポリシー設定  
  所属するリソースが満たすべき条件

- 課金集計  
  所属するリソースの利用料を集計

- 一括削除  
  リソースグループを削除すると、リソースグループ内のすべてのリソースが削除される。

### - **管理グループ**

Azureでは管理グループが提供されており、テナント内の複数サブスクリプションをまとめて管理できる。

***

## ■ AzureのDCの構成

### - **リージョンとソース**

一部のリソースはリージョン指定がない(***グローバルサービス***)。  
大半のリソースはリージョンを指定する***リージョンサービス***。

### - **一般利用可能なリージョン**

- リージョン (地域)  
  最低1つのDC。都道府県や州まで公開。

### - **特別なAzureリージョン**

- Azure Goverment (北米)  
  アメリカの行政機関やそのパートナー企業などが利用できる

- Azure Chine  
  中国内のリージョンは、21Vianet社が運営している(この企業と契約する必要がある)。

- Azure Germany  
  特別なセキュリティ対策の下で運営されているリージョンで、EUのデータ保護規制を遵守するために提供。

### - **リージョンペア**

どのリージョンも、同じ地理内の別のリージョンとペアで構成されている。

数百Km離れたところに設定され、変更不可。地域全体の障害への基本対策となる。

リージョンペア内でAWSリソースを複製することで、自然災害や電源・NW停止に備えることが可能。

### - **可用性ゾーン(AZ)**

数km～数十km離れたところにある近接したDC群。

データセンター障害への基本対策になる。

- **SLA(サービスレベルアグリーメント)**  
  Microsoftがサービスを提供する上での保証値。

### - **リージョン内の冗長化**

- 可用性セット(Availability Set)  
  DC内でハードウェア障害が発生した場合や、メンテナンスが必要になった場合でも、  Azureに展開したアプリケーションやサービス全体の停止を抑止するための構成。  
  同じ可用性セットに配置された複数の仮想マシンは、ハードウェア障害やソフトウェア更新があっても「同時には停止しない」ことが保証される。

- 更新ドメイン(Update Domain:UD)  
  Azureを構成している物理マシンはWindows ServerをベースとしたHyper-V環境を利用している。  
  更新の結果、物理マシンが再起動すると、その物理マシンで稼働している仮想マシンが一時的に停止してしまう。  
  これを避けるため、更新プログラムの適用などのメンテナンスイベントは、複数の物理マシンをまとめた更新ドメインの単位で順番に適用される。  
  更新ドメインはDCの論理的な区分。異なる更新ドメインのリソースは影響を受けない。

- 障害ドメイン(Fault Domai:FD)  
  サーバーラックに配置された物理サーバーをサポートする電源、ファンなどの冷却装置、NWハードウェアが含まれる。  
  特定のサーバーラックに含まれるハードウェアに障害発生時、停止の影響を受けるのはそのラックのサーバーに限定される。

***

## ■ コンピューティングサービス

### - **仮想マシン(VM)**

オンプレミスのサーバー機能をそのままクラウドで動作させるのに最も手軽。

- Azure VM  
  WindowsまたはLinuxを指定して展開する。既存のOSの機能がそのまま利用できるため、オンプレミスに展開する物理マシンや仮想マシンと同じように、  
  Azure VMの環境をカスタマイズして利用できる。  
  Azure Marketplaceで公開されているイメージか、利用者自身で作成する独自のイメージを登録して指定する。

- Azure Virtual Machine Scale Set (仮想マシンスケールセット)  
  同じ構成の複数の仮想マシンをグループとして作成及び管理できるAzureコンピューティングのリソース。  
  スケールセット内で負荷分散したり、自動スケールを構成できる。

- Windows Virtual Desktop  
  クラウドで実行されるデスクトップやアプリケーションの仮想化サービス。  
  Windows10やMicrosoft365に最適な*VDI*であり、「シンクライアント」環境を提供する。

  >シンクライアント  
  端末にデータやアプリケーションソフトを置かず、それらの資源をサーバ側で一元管理するシステムの総称。  
  クライアント端末側でデータ等を保有せず、利用できる機能も制限されるため、情報漏洩やセキュリティ強化対策として有効

- コンテナ―  
  軽量で、動的に作成、スケールアウト、および停止でき、素早く再起動できる仮想化環境。  

- Azure Container Instance  
  Docker社のコンテナ技術をAzure上に実装したもの。  
  保存場所は*Azure Container Registry(ACR)*(≒DockerHub)。

- Azure Kubernetes Service  
  多数のコンテナを容易に管理するためのサービス。

***

## ■ ネットワークサービス

### - **Azure Virtual Network**(VNET)

仮想マシンやその他のAzureリソースを接続するNW。  
Azureに作成された仮想NWには1つ以上のサブネットを作成し、VMマシンを配置する。

***既定ではサブネット間の通信は制限されない***ため、同じ仮想NWに参加しているVMマシン間は異なるサブネットでも通信可能。

これは、仮想NWには**システムルート**と呼ばれる自動で構成されるルーティング環境があるため。