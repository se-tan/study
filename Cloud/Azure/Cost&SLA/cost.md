# コストの計画と管理

Azure製品やサービスで得利用することが可能な購入オプションとしては以下の通り。

- 従量課金(Webダイレクト)  
  一定条件を満たせば請求書処理に切り替え可能。

- エンタープライズアグリメント (EA)  
  マイクロソフトと直接契約。年額コミットメントがある代わりに割引を受けられる。

- クラウドソリューションプロバイダ (CSP)  
  Azure製品等を代理店経由で購入する。請求書処理が一般的だが、クレジットカードが使える場合もある。

***

## ■ Azureのコストに影響を与える要因

Azureの主なコスト要因には、以下がある。

### - **リソースの種類**

リソースの種類が違うと*メーター*(課金項目)の種類も異なる。

詳細の確認は、「コストの管理と請求」→「コスト管理」から「コスト分析」内の「リソースごとのコスト」ビューを使う。

「コスト管理」で表示されるツールは***Azure Cost Management***と呼ばれ、Azureのコスト管理全体を総合的に監視・分析する機能を持つ。

<br>

### - **サブスクリプション**

Azureの使用料金や請求期間は、サブスクリプションの種類によって異なる。

データとしてダウンロードしたり、情報を取得したりできるが、特定のロールに限定される。

<br>

### - **場所(リージョン)**

Azureリソースの多くはリージョンごとに単価が異なるため、あえて遠方のリージョンを選択する場合もある。

しかし、リージョン間通信は有料のため、リージョン変更によるコスト削減効果が、データ転送の追加コストで相殺される可能性がある。

<br>

### - **仮想マシン**

起動してから秒単位で実行時間が計測され、分単位で課金される。  
仮想マシン内でシャットダウンした場合、「停止」状態になるが、物理マシンの割当は解除されず、**課金は停止しない**。

Azureの管理ツールから「停止」を行なうことで、シャットダウン後に「割当解除」状態になり、課金が停止する。

<br>

### - **データ転送トラフィック**

データ転送トラフィックは、AzureDC間で送受信されるデータを指し、「帯域(bandwidth)」とも呼ぶ。

- インターネットとの通信  
  DCから送信するデータ量に応じて課金される。受信データには課金されない。  
  DC所在地によって料金が決まり、5GBまでは無料、以降は送信データ量に応じて段階的に安くなる。

- Azureリージョン間の通信  

- ピアリング  
  ネットワーク間で通信が発生すると、送信側と受信側で課金が発生する

- 可用性ゾーン  
- 可用性ゾーン間の通信は、送受信共に課金される

***

## ■ 総保有コスト(TCO)計算ツール

パブリッククラウドの料金をオンプレミスと同様の構成で計算すると割高になることがある

- 仮想マシンが同じ台数で常時稼働することを前提としている
- クラウドによって節約できる運用コストを考慮していない

総保有コスト計算ツールは、管理コストの削減効果を可視化するツール。手順は以下3つ

### - **ワークロードの定義**

オンプレミスのサーバ利用状況を入力する。

- サーバー：現在のオンプレミスサーバーの詳細情報を入力
- データベース：オンプレミスのDB情報の詳細を入力
- ストレージ：オンプレミスのストレージの詳細を入力
- ネットワーク：オンプレミス環境で現在使用しているNW帯域幅の情報を入力

<br>

### - **前提条件の調整**

- ソフトウェアアシュアランスの有無
- geo冗長ストレージ(GRS)の有無
- 仮想マシンのコスト
- 電力コスト
- ストレージ調達コスト
- IT人材コスト
- その他コスト

<br>

### - **レポートの表示**

入力した情報と前提条件に基づいて詳細レポートが生成される

***

## ■ コストの最適化

### - **コスト分析の実行**

Azure Cost Management内の「コスト分析」を使用して、現状のコスト分析と将来の予測が可能。

<br>

### - **Azure Advisorの使用**

未使用のリソースや使用率の低いリソースの特定

<br>

### - **Azureの使用制限の使用**

無料アカウントやメンバープランなど、毎月の使用枠が設定されたサブスクリプションには、無料使用枠内での使用制限機能がある。  
これにより、無駄なコストを発生させるのを抑えることができる。

<br>

### - **Azureの予約(RI)の使用**

Azureの予約(リザーブドインスタンス：RI)は、利用料金を1年または3年分、事前に支払うことで得られる割引制度。

**指定したサイズの使用に対する割引**のため、一度仮想マシンを削除しても、同じサイズの仮想マシンを再生成すれば、そのインスタンスに対して予約価格が適用される。

<br>

### - **Azureハイブリッド特典の使用**

一部Microsoft製品には移動可能ライセンスがある。既に保有しているライセンスをAzureに持ち込むことで、ライセンス分のコストを節約できる(**Azureハイブリッド特典：AHB**)。

<br>

### - **タグを適用したコスト所有者の識別**

人事、営業などに部門別、本番/テストなどの環境別にリソースにタグを付与しておけば、簡単にそれらの分類でコストを集計できる。

Azure Policyを使用すればタグ付けを強制できる。

***

## ■ Azure Cost Management

利用コストの計画、分析、最適化を行うツール。

- コスト分析：こうsとに関するレポートを表示する。
- 予算：使用量が予算を超過しそうになった時点で、アラートによる通知や悪書を実行する
- アラート：予算の利用率に応じて、複数のアラートを作成できる
- アドバイザーの推奨事項：未使用状態のリソースを検出し、コスト削減の推奨事項を表示