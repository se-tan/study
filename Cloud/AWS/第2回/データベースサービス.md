# データベースサービス

## RDS (Amazon Relational Database Service)
### 1. オンプレミス、RDS、EC2の違い
* オンプレミス  
    DBサーバを構築する場合、電源、空調、NWなど設備からアプリケーションの最適化まですべてお客様が担当

* EC2  
    物理要素まではAWSが担当するが、EC2より上はお客様の責任になる。例えばOSの脆弱性が見つかればバッチの適用が必要になり、  
    DBのインストール、マイナーバージョンのバージョンアップなどをしなくてはならない。

* RDS  
    アプリケーションの為にSQLクエリを最適化するなど、アプリケーションの開発のみに注力し、他全てはAWSが担当する。  
    ＝インフラ管理から開放される

<br>

### 2. メンテナンス
OSのメンテナンスは週に1回、お客様が設定した時間に自動的に行われる。DBのマイナーバージョンアップグレードは、自動適用するか否かを選択できる。  
OS、DBエンジンのメンテナンスをAWSに任せることができる。

<br>

### 3. バックアップ    
RDSではデフォルトで7日間の自動バックアップが適用されている。期間は0～35日間まで設定でき、指定した時間にバックアップデータが作成される。  
**ポイントタイムリカバリー**は、トランザクションログが保存されていることによって、自動バックアップを設定している期間内であれば、  
数秒までを指定して特定の時点のインスタンスを復元/起動できる。

<br>

### 4. 高可用性
Web層やアプリケーション層で負荷分散やAuto Scalingによる高可用性を実現していても、DBサーバが1つしかなければ、DBサーバに障害が発生した際にシステム機能は停止する。  
単一障害点とならないよう設計する必要がある。  

<br>

RDSのマルチAZをオンにすると、AZをまたいだレプリケーションが自動的に行われる。  
マスターとスタンバイの間でレプリケーションが実行され、マスターに障害が発生した際には自動的にフェールオーバーされ、スタンバイDBがマスターになる。  
Amazon Aurora、MySQL、PostgreSQL、MariaDBではリードレプリカを作成でき、これにより、読み込みの負荷をマスターDBから軽減できる。  
他のリージョンにリードレプリカを作成することもできる(**クロスリージョンリードレプリカ**という)。

<br>

## Amazon Aurora
AWSがクラウドに最適化して再設計したRDBエンジン。MySQL、PostgreSQLをサポートしている(I/F機能を持っている)。

<br>

## DMS (AWS Database Migration Service)
DB間でデータを移行できるサービス。オンプレミスからAWS、AWSからAWSへのデータ移行などを容易に行える。  
移行時のシステムダウンタイムを最小限に抑えることができ、同じDBエンジンでも、異なったDBエンジンでも移行ができる。

<br>

## DynamoDB
NoSQL型の高いパフォーマンスを持ったフルマネージド型のDBサービス。データ容量は無制限で、使用している容量のみが課金対象となる。  
使用する際に決めるのはリージョン。AZは意識しなくても使用可能。テーブルにアイテムを保存すると、自動的に複数のAZの複数の施設で同期され保存される。  
→最初からマルチAZな環境になっている。
>*フルマネージド型*  
お客様が管理する範囲が極めて小さいということ。DBのOSや、DBエンジン、テーブルの破損などを気にしなくてよいということ。  
DynamoDBを使用する際はテーブルの作成から始める。DBサーバとしてインスタンスを作成する必要がなく、  
最低限の設定では、テーブル名とプライマリキーを決定すれば使い始めることができる。

<br>

### DynamoDBとRDSの違い
RDSはRDBで、DynamoDBはそうではないというのが大きな違い。  
DynamoDBは**非リレーショナルデータべース**や**NoSQL**と言われる。RDSではトランザクションをコミットにより確定できるので、厳密な確定処理に向いている。  
しかし大量のデータ更新や読み込みを必要とする処理には向いていない。  

<br>

* RDS  
    垂直スケーリングによりスケールアップすることができる。基本的には1つのインスタンスで処理を行なうので、大量アクセスには向かない。  
    SQL型のテーブル形式で、列が固定で行に対してアクセスする。

* DynamoDB  
    水平スケーリングができる。大量アクセスがあってもパフォーマンスを保ったまま処理ができる。ただし、厳密な処理や複雑なクエリには向かない。
    NoSQL型のテーブル形式で、1つのデータはアイテム(項目)として扱う。キーとして設定している属性と値さえあれば、それ以外の属性は動的で自由。  
    不確定な入れ物に自由に情報を格納して、キーを検索のためのインデックスとして扱うイメージで、データを管理できる。