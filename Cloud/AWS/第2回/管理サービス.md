## CloudWatch
各インスタンスの状態、情報をモニタリングするサービス。**標準メトリクス**というAWSが管理している範囲の情報を、お客様側での追加の設定なしで収集している。  
例としては、EC2インスタンスを起動しただけで、5分起きにCPU使用率のようなメトリクスデータが収集される。

<br>

### 標準(組み込み)メトリクスの収集、可視化
AWSがコントロールできる範囲(EC2ならハイパーバイザーまで)の、AWSが提供している範囲で知り得る情報を標準メトリクスとして収集している。  
収集された値は、マネジメントコンソールのメトリクス画面やダッシュボードで可視化できる。
>標準メトリクスは、使用するサービスによって取得される情報が異なる。

<br>

### カスタムメトリクスの収集、可視化
EC2では、OS以上の範囲、およびお客様がコントロールしている範囲については標準メトリクスとしては収集されない。  
これらの情報は、CloudWatchの**PutMetricData** APIを使用してCloudWatchへ**カスタムメトリクス**として書き込むことができる。  
CloudWatchへメトリクスを書き込むプログラムは**CloudWatchエージェント**として提供されているので、EC2へインストールするだけで使用できる。  

<br>

### ログの収集
CloudWatchにはログを収集する機能もあり、**CloudWatch Logs**という。EC2のアプリケーションのログや、AWS Lambdaのログ、VPC Flow Logsなどを収集できる。  
ログの情報をEC2の外部に保管することで、EC2をよりステートフル(情報や状態を持たない構成)にできる。  

>障害が発生してログ調査が必要になった場合  
EC2のローカルにだけログがある場合、そのログファイルを退避するまでEC2を終了することができない。  
Auto Scalingの場合、異常とみなされたEC2インスタンスは自動で終了するが、この場合は自動で終了させるわけにはいかない。  
CloudWatch Logsへ書き出しておけば、Auto Scalingで終了させることができ、後でログ分析して調査ができる。

<br>

### アラーム
CloudWatchでは、各サービスから収集したメトリクス値に対してアラームを設定できる。  
例えば以下のようなサービス状態(=メトリクス値)に対してアラームを設定可能で、それぞれにアクションを実行できる
* EC2のCPU使用率が10分間、80%を上回っている  
    EC2の回復：EC2ホストに障害が発生したときに自動で回復する

* ログに「Out of Memory」という文字列が5分間で2回出現したとき  
    Auto Scaling実行：Auto Scalingポリシーでは、CloudWatchアラームに基づいて、スケールイン/アウトのアクションを実行する。

* RDSのディスク空き容量が残り10GB未満になって5分間そのままのとき  
    SNSへの通知：AWS Simple Nortification Service(SNS)へ通知することで、メッセージをメールで受信したり、Lambdaへ渡すことが可能。

<br>

### 保存期間
* メトリクス：以下期間を超えたメトリクスは消去される  
    1. 60秒未満のデータポイント(高分解能カスタムメトリクス)は3時間  
    2. 1分(詳細モニタリング)のデータポイントは15日間  
    3. 5分(標準)のデータポイントは63日間  
    4. 1時間のデータポイントは455日間

* CloudWatch Logs：任意の保存期間を設定可能。消去しない選択も可能

***

## Truxted Advisor
お客様のAWSアカウント環境の状態を自動的にチェックして回り、ベストプラクティスに対してどうであったかを示すアドバイスをレポートする。

<br>

### コスト最適化
具体的にどれぐらい月額コストが下がるかという金額も計算されて提示される。
1. 使用率の低いEC2インスタンス  
    未使用のインスタンスは終了する、過剰なインスタンスは適切なサイズに変更するなどの対策で、コストを最適化できる。

2. リザーブドインスタンスの最適化  
    EC2の利用状況をチェックして、リザーブドインスタンスを購入したほうがコスト最低化につながるかをレポートする。  
    購入済みリザーブドインスタンスも、有効期限が切れる30日前からアラート対象になる。

<br>

### パフォーマンス
1. 使用率の高いEC2インスタンス  
    EC2に実装している処理に対してリソースが不足している可能性がある。システムパフォーマンスが良い状態とは言えない。

2. セキュリティグループルールの増大  
    セキュリティのルールが多いとそれだけNWトラフィックが制御されることになる。50以上のルールがあるとパフォーマンス低下につながる可能性がある。  

3. コンテンツ配信の最適化  
    CloudFrontにキャッシュを持つことで、S3から直接配信するよりもパフォーマンスが向上する。  
    また、キャッシュがどれだけ使われているかを示すヒット率についてもチェックされる。

<br>

### セキュリティ
1. S3バケットのアクセス許可  
    誰でもアクセスできるS3バケットはないかチェックする。

2. セキュリティグループの開かれたポート  
    リスクの高い特定のポートが、送信元無制限でアクセス許可されているセキュリティグループをピックアップする。  
    悪意あるアクセスによって攻撃され、データが漏洩する可能性がある。

3. パブリックなスナップショット  
    EBSやRDSのスナップショットは他の特定のアカウントに共有することもでき、アカウントを特定せずに公開共有することもできる。  

4. ルートアカウントのMFA、IAMの使用  
    IAMユーザーがいないアカウント=ルートアカウントを使用しているアカウント。権限を制限できないアカウントを運用で使用するのは非常に危険な状態。  
    そのルートアカウントにMFA(多要素認証)を設定していないことも非常に危険。

<br>

### フォールトトレランス(耐障害性)
1. EBSのスナップショット  
    EBSのスナップショットが作成されていない、または最後に作成されてから時間が経過したことがチェックされる。  
    EBSボリュームはAZ内で複製されているが、AZに障害が発生する可能性はあるので、EBSのスナップショットを作成しておけば、S3に保持され、  
    複数のAZ上で高い耐久性でデータが保持されることになる。

2. EC2、ELBの最適化  
    複数のAZでバランスよく配置されているかがチェックされる。ELBではクロスゾーン負荷分散やConnection Draining(セッション完了を待ってから切り離す機能)が  
    無効になっているロードバランサーがないかもチェックされる。

3. RDSのマルチAZ  
    マルチAZになっていないｄｂインスタンスがチェックされる。

<br>

### サービス制限
AWSアカウント作成時点では、**ソフトリミット**と呼ばれるサービス制限がある。  
>理由は以下の通り  
1. 誤った操作による意図しない請求の回避  
2. 不正アクセスによる意図しない請求を回避

<br>

***

## CloudTrail
AWSアカウント内の全てのAPI呼び出しを記録する(**AWSアカウント内の全ての操作を記録する**)。  
 
<br>

## AWS Config
AWSリソースの変更を自動記録し、運用効率と整合性を高める。

<br>

## CloudFormation
AWSの各リソースを含めた環境を自動作成/更新/管理する。  
JSON形式またはYAML形式で記述されたテンプレートから、Stackというリソースの集合体を作成する。CloudFormationを使用することで、  
同一のAWS環境を何度でも自動で構築することができる。  
このようにCloudFormationでは、自動的なプロビジョニングをコードを用いて行なえる。コードは**AWS CodeCommit**などのリポジトリでバージョン管理できる。  
このような機能のことを**IaC**(Infrastructure as Code)と呼ぶ。
>Dockerでいうdocker-compose/Dockerfileに近い

<br>

## Elastic Beanstalk
Webアプリケーションの環境を簡単にAWSに構築できる。CloudFormationと似ているが、テンプレートを作成する必要はない。  
設定パラメータを提供することで、ApacheやNginx、IIS、各言語の実行環境もあわせて簡単に構築できる。  
ただし、AWSの全てのサービスを網羅しているわけではなく、Webアプリケーションやタスク実行環境を構築することに向いている。
>docker run に近い？