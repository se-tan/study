# ネットワークサービス

## VPC (Virtual Private Cloud)
AWSクラウド内にプライベートなネットワーク環境を構築できる。  
主な機能要素は、VPC、サブネット、インターネットゲートウェイ、ルートテーブル、セキュリティグループ、  
ネットワークACL、NATゲートウェイ(NATインスタンス)。

<br>

### CIDR (Classless Inter-Domain Routing)
10.0.0.0/16のようにIPアドレスの範囲を定義する。これにより10.0.0.0 ~ 10.0.255.255までの65,536のIPアドレスを使用できる。

<br>

### サブネット
VPCで設定したアドレス範囲をサブネットに分けて定義する。サブネットは作成するときにAZとIPアドレスを定義する。  
IPアドレス範囲はVPCで定義した範囲内で定義する必要があり、同一VPC内の他のサブネットと重複してはいけない。

<br>

### インターネットゲートウェイ
VPCとパブリックインターネットを接続するためのゲートウェイ。VPCにつき1つのみ作成可能。  
水平スケーリングによる冗長性と高い可用性を持っているため、**単一障害点(SPOF)**にはならない。帯域幅の制限もない。VPCにアタッチして使用する。

<br>

### ルートテーブル
サブネットの経路をルートテーブルで設定する。ルートテーブルはVPCを選択して作成する。  
VPCを作成したときに、**メインルートテーブル**というルートテーブルができる。サブネットに関連付けられたデフォルトのルートテーブルのため、  
そのまま使用するのではなく、カスタムルートテーブルを作成してサブネットに関連付ける。

<br>

### パブリックサブネットとプライベートサブネット
* パブリックサブネット  
    IGWに対してのルートを持つルートテーブルに関連付けられる。パブリックサブネット内のインスタンスなどのリソースは、  
    外部との直接通信が可能。

* プライベートサブネット  
    IGWに対してのルートを持たないルートテーブルに関連付けられる。  
    プライベートサブネット内のインスタンスは外部アクセスから保護される。各サブネット間にはローカル接続のルートがあるので、  
    プライベートサブネット内のリソースは、パブリックサブネット内のリソースと通信できる。

<br>

### セキュリティグループ
仮想ファイアウォール機能のこと。VPC内のリソースのトラフィックを制御する。  
セキュリティグループの送信元はCIDRでIPアドレス範囲を指定するか、他のセキュリティグループのIDを指定することも可能。  
デフォルトではインバウンドへのアクセスがすべて拒否されているため、許可するものだけを設定する(≒ホワイトリストの設定)。  
>*Point*  
    1. セキュリティグループは、インスタンスに対してのトラフィックを制御する仮想ファイアウォール  
    2. 許可するインバウンドのポートと送信元を設定するホワイトリスト  
    3. 送信元には、CIDRか他のセキュリティグループのIDを指定できる

<br>

### ネットワークACL
サブネットに対して設定する仮想ファイアウォール機能のこと。サブネット内の全てのリソースに対してのトラフィックに影響がある。  
デフォルトで全てのインバウンドとアウトバウンドが許可されている。許可の設定も拒否の設定も可能。  
ネットワークACLは必要な要件があった場合のみに設定する、追加のセキュリティレイヤーとして機能させることができる。  
特に指定がなければデフォルトで全てのトラフィックを許可して問題ない。

<br>

### ハイブリッド環境構成
既存のオンプレミス環境からVPNまたは専用線で接続することが可能。つまり、オンプレミス環境の拡張先としてAWSを使用できる。

<br>

### ダイレクトコネクト
帯域を確保するため、もしくはセキュリティとコンプライアンス要件を満たすために専用線を選択することもある。  
そういった場合にダイレクトコネクト(AWS Direct Connect)を利用することで、AWSとDCの間でプライベートなNW接続を確立できる。  
AWS Direct Connectは、ハイブリッド環境を構築する上で非常に重要なサービスである。

<br>

### VPCピアリング接続
オンプレミスとの接続以外にも、複数のVPC同士を接続する機能。  
同じリージョン、同じアカウントだけでなく、別のリージョン、別のアカウントの複数のVPCとも接続できる。  
他にも大規模NWの構築も可能なAWS Transit Gatewayや、クライアントベースのAWS Client VPNがある。

***

## CloudFront
世界中に150か所以上あるエッジロケーションを使い、最も低いレイテンシーでコンテンツを配信できるコンテンツ配信ネットワーク(CDN)サービス。  

<br>

### キャッシュによる低レイテンシー配信
S3やELB経由のEC2からWebコンテンツを配信する場合、都度、オリジナルコンテンツにアクセスする。  
地理的な理由や、コンテンツ容量が大きくEC2に負荷がかかっている等の理由で、ユーザーへの配信に遅延が発生すると、  
そのコンテンツを視聴する全てのユーザーに同じように遅延が発生する。

<br>

CloudFrontを使用してエッジロケーションにキャッシュを持つことで、同じ場所にいる3人のユーザーがアクセスしたとき、  
1人目のユーザーはオリジナルコンテンツからの配信をCloudFront経由で受けるが、2人目以降はオリジナルコンテンツにはアクセスせず、  
CloudFrontのキャッシュから配信を受ける。これによりユーザーは低レイテンシーで配信を視聴できる。

<br>

### ユーザーの近くからの低レイテンシー配信
世界中のエッジロケーションが利用できるので、ユーザーへは最もレイテンシーの低いエッジロケーションから配信される。
>*エッジロケーション*  
「サービスを提供するためのデータセンター」のこと。AZやリージョンとは別のリージョン。

<br>

### 安全性の高いセキュリティ
お客様が所有しているドメインの証明書を設定できる。これによりユーザーからHTTPSのアクセスを受けることができ、  
通信データを保護できる。証明書は**AWS Certificate Manager**を使用すると、追加費用なしで作成と管理ができる。  

AWS ShieldやAWS WAFと組み合わせることで、外部からの攻撃や脅威からオリジナルコンテンツを保護できる。

***

## AWS Route 53
DNSサービスのこと。ドメインに対してのIPアドレスをマッピングしてユーザーからの問い合わせに回答する。エッジロケーションで使用される。

<br>

### 様々なルーティング機能
* シンプルルーティング  
    問い合わせに対して、単一のIPアドレス情報を回答する。

<br>

* レイテンシーベースのルーティング/Geo DNS  
    1つのドメインに対して複数のDNSレコードを用意しておき、地理的な場所を近くしてレイテンシー(遅延度)が低くなるようにルーティングを行う。

<br>

* 加重ラウンドロビン  
    1つのドメインに対して複数のDNSレコードを用意しておき、割合を決める。その割合に応じて回答を返す。

<br>

* 複数値回答  
    複数のレコードからランダムに回答する。

<br>

### 高可用性を実現するヘルスチェックとフェイルオーバー
複数のレコードを設定し、システムの高可用性を世界中のリージョンを使用して実現可能。

<br>

### ルートドメイン(Zone Apex)のエイリアスレコード
Aレコードなどの各レコードにエイリアスを設定することができる。エイリアスは**Zone Apex**と呼ばれる、サブドメイン(wwwなど)のないルートドメインにも設定可能。  
これにより、ルートドメインにも複数のリソースを設定でき、可用性の高いシステム構成を作ることができる。