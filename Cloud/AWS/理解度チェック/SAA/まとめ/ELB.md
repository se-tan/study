# ■ ELBの基礎
AWSが提供する仮想ロードバランサーでVPC上に構成される。

***耐障害性を高めるために必ず2つ以上のAZを指定***

# ■ ELBの種類と特徴
## > Application Load Balancer
レイヤー7をサポートするコンテンツベースのL7リバースプロキシロードバランサー。

HTTTP/HTTPSプロトコルによって通信を行う構成とした場合に適している。

- 同一のインスタンスで複数ポートに負荷分散
- IPアドレスをターゲットに設定
- パスベースのルーティングのサポート
- ホストベースのルーティングのサポート,
- ネイティブHTTP/2対応

## > Network Load Balancer
レイヤー4/5をサポートするL4NATロードバランサー。

レイヤー4のTCPおよびレイヤー5のTLSのプロトコルをサポート。

- 固定IPアドレス  
  ***NLBでは固定IPアドレスを指定可能***。ロードバランサーのアクセス先をドメイン名ではなくIPアドレスで指定しなければならないケースに利用

- ネットワーク経路とパフォーマンス  
  ALBやCLBと異なり、NATタイプのロードバランサーである。通常、リクエストと応答いずれもロードバランサー経由で行なわれるが、  
  NLBは***トラフィックの宛先IPアドレスをターゲットのIPアドレスに書き換えて転送するため、応答のトラフィックはロードバランサーを経由せずにターゲットから直接クライアントに送られる***。

- NLBのアクセス許可設定  
  セキュリティグループ機能が提供されていない為、ターゲットのインスタンス側でインターネット側のアクセス元を許可する必要がある。


# ■ ELBのスケーラビリティ
負荷が増減すると、***ELB自体が負荷に応じて自動でスケールする***。ただし、スケーリングが間に合わない場合は、HTTP503を応答として返す。

## > Pre-Warming
***AWSサポートに申請を行なう***ことで事前にELBをスケールさせ、クライアントにエラーを返すのを回避する機能

AWSサポートプランの**ビジネスかエンタープライズ**に加入している必要がある。

# ■ ヘルスチェック
ターゲットのインスタンスに対してTCP/HTTP/HTTPSのプロトコルで応答確認を行う。

正常状態と判断した場合のみリクエストをターゲットのインスタンスに転送する。

異常状態と判断した場合は、そのインスタンスへの転送を停止する。ELBは転送の停止のみで、実際には***CloudWatchに通知されたり、Auto Scaling機能でインスタンスの破棄等が行なわれる***。


# ■ パスベース/ホストベースのルーティング
## > パスベースのルーティング
リクエスト内のURLに基づいてリクエストを転送するルーティング方式。

コンテナサービス上のアプリケーションなどにURLのパスに基づいて1つのALBからリクエストを振り分けられるようになった。

## > ホストベースのルーティング
HTTPヘッダー内のホストフィールドに基づいてリクエストを転送するルーティング方式。

1つのALBからターゲットのインスタンスに振り分けられるようになった。